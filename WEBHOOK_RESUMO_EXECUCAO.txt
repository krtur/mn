â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘    ğŸš€ RESUMO EXECUTIVO - DEPLOY AUTOMÃTICO CORRIGIDO          â•‘
â•‘    M&N Terapeutas - GitHub Webhook                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

============================================
ğŸ¯ O QUE FOI FEITO
============================================

Criamos uma soluÃ§Ã£o completa de deploy automÃ¡tico com:

1. âœ… webhook-server.js
   - Servidor Node.js que recebe webhooks do GitHub
   - Verifica assinatura SHA256 para seguranÃ§a
   - Executa deploy automaticamente
   - Logging detalhado de todas as aÃ§Ãµes

2. âœ… WEBHOOK_SETUP_FINAL.sh
   - Script de instalaÃ§Ã£o automÃ¡tica
   - Configura serviÃ§o systemd
   - Configura Nginx como proxy reverso
   - Configura firewall

3. âœ… DocumentaÃ§Ã£o completa
   - WEBHOOK_GUIA_COMPLETO.txt (guia detalhado)
   - WEBHOOK_TESTE_RAPIDO.txt (teste em 5 minutos)
   - Este arquivo (resumo executivo)

============================================
âš¡ COMO USAR (3 PASSOS)
============================================

PASSO 1: Copiar arquivos para o VPS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Do seu computador, execute:

   scp webhook-server.js root@31.97.252.100:/var/www/mn/
   scp WEBHOOK_SETUP_FINAL.sh root@31.97.252.100:/var/www/mn/

Ou, se preferir, copie manualmente via SCP ou WinSCP.

PASSO 2: Executar script de setup no VPS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

No VPS, execute:

   ssh root@31.97.252.100
   cd /var/www/mn
   chmod +x WEBHOOK_SETUP_FINAL.sh
   ./WEBHOOK_SETUP_FINAL.sh

O script irÃ¡:
   âœ… Criar usuÃ¡rio webhook
   âœ… Configurar permissÃµes
   âœ… Criar serviÃ§o systemd
   âœ… Configurar Nginx
   âœ… Configurar firewall
   âœ… Testar webhook

Tempo: ~1 minuto

PASSO 3: Configurar webhook no GitHub
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. Acesse: https://github.com/krtur/mn/settings/hooks

2. Clique em "Add webhook"

3. Preencha:
   Payload URL:
   http://31.97.252.100:9000/hooks/mn-deploy

   Content type:
   application/json

   Secret:
   c07e7eaa5d8bab70edf4b3acb837f9426ce96fbbd12ee2b270821cecb11b19b8

   Events:
   â—‹ Just the push event

   Active:
   â˜‘ Active

4. Clique em "Add webhook"

Tempo: ~2 minutos

============================================
ğŸ§ª TESTAR (5 MINUTOS)
============================================

1. No seu computador:
   git commit -m "teste webhook" --allow-empty
   git push origin main

2. No VPS, veja os logs:
   ssh root@31.97.252.100
   journalctl -u webhook -f

3. Aguarde 2-3 minutos

4. Recarregue o site:
   http://31.97.252.100

Se tudo funcionou, vocÃª verÃ¡ os logs do deploy!

============================================
ğŸ“Š COMO FUNCIONA
============================================

1. VocÃª faz push no GitHub
   â†“
2. GitHub envia notificaÃ§Ã£o para:
   http://31.97.252.100:9000/hooks/mn-deploy
   â†“
3. Webhook verifica assinatura SHA256
   â†“
4. Webhook executa:
   - git pull origin main
   - npm install
   - npm run build
   - pm2 restart mn-backend
   - systemctl restart nginx
   â†“
5. Site Ã© atualizado automaticamente

â±ï¸ Tempo total: 2-3 minutos

============================================
ğŸ“‹ COMANDOS ÃšTEIS
============================================

Ver status do webhook:
   systemctl status webhook

Ver logs em tempo real:
   journalctl -u webhook -f

Ver Ãºltimos 50 logs:
   journalctl -u webhook -n 50

Reiniciar webhook:
   systemctl restart webhook

Parar webhook:
   systemctl stop webhook

Iniciar webhook:
   systemctl start webhook

Testar health check:
   curl http://31.97.252.100:9000/health

Testar deploy manual:
   curl -X POST http://31.97.252.100:9000/hooks/test

============================================
ğŸ” TROUBLESHOOTING
============================================

PROBLEMA: Webhook nÃ£o responde
   â†’ systemctl status webhook
   â†’ journalctl -u webhook -n 20
   â†’ systemctl restart webhook

PROBLEMA: Deploy nÃ£o executa
   â†’ Verifique webhook no GitHub
   â†’ Teste: curl -X POST http://31.97.252.100:9000/hooks/test
   â†’ Veja logs: journalctl -u webhook -f

PROBLEMA: Assinatura invÃ¡lida
   â†’ Verifique secret no GitHub
   â†’ Copie exatamente: c07e7eaa5d8bab70edf4b3acb837f9426ce96fbbd12ee2b270821cecb11b19b8

PROBLEMA: Site nÃ£o atualiza
   â†’ Aguarde 2-3 minutos
   â†’ Limpe cache do navegador (Ctrl+Shift+Del)
   â†’ Recarregue (Ctrl+F5)

Para mais detalhes: WEBHOOK_GUIA_COMPLETO.txt

============================================
ğŸ“ ARQUIVOS CRIADOS
============================================

1. webhook-server.js
   Servidor Node.js para receber webhooks

2. WEBHOOK_SETUP_FINAL.sh
   Script de instalaÃ§Ã£o e configuraÃ§Ã£o

3. WEBHOOK_GUIA_COMPLETO.txt
   Guia detalhado com troubleshooting

4. WEBHOOK_TESTE_RAPIDO.txt
   Teste em 5 minutos

5. WEBHOOK_RESUMO_EXECUCAO.txt
   Este arquivo

============================================
âœ… CHECKLIST
============================================

[ ] Copiar webhook-server.js para VPS
[ ] Copiar WEBHOOK_SETUP_FINAL.sh para VPS
[ ] Executar WEBHOOK_SETUP_FINAL.sh
[ ] Verificar: systemctl status webhook
[ ] Testar: curl http://31.97.252.100:9000/health
[ ] Configurar webhook no GitHub
[ ] Testar com commit vazio
[ ] Verificar logs: journalctl -u webhook -f
[ ] Recarregar site
[ ] Documentar configuraÃ§Ã£o

============================================
ğŸ‰ RESULTADO FINAL
============================================

âœ… Deploy automÃ¡tico funcionando
âœ… Webhook recebendo notificaÃ§Ãµes do GitHub
âœ… Site atualizado automaticamente a cada push
âœ… Logs detalhados para monitoramento
âœ… FÃ¡cil de manter e debugar

De agora em diante:
   git commit -m "descriÃ§Ã£o"
   git push origin main
   â†’ Site atualizado em 2-3 minutos!

============================================
ğŸ“ SUPORTE
============================================

Se algo nÃ£o funcionar:

1. Consulte: WEBHOOK_GUIA_COMPLETO.txt
2. Verifique logs: journalctl -u webhook -f
3. Teste manualmente: curl -X POST http://31.97.252.100:9000/hooks/test
4. Reinicie: systemctl restart webhook

Qualquer dÃºvida, execute os comandos Ãºteis acima.

============================================
ğŸš€ PRONTO PARA USAR!
============================================

Siga os 3 passos acima e seu deploy automÃ¡tico
estarÃ¡ funcionando perfeitamente!

Bom trabalho! ğŸ‰
