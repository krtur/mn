â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘    ğŸ”§ CORREÃ‡ÃƒO DO DEPLOY AUTOMÃTICO - GUIA COMPLETO           â•‘
â•‘    M&N Terapeutas - VPS                                      â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸš¨ PROBLEMA: O deploy automÃ¡tico no VPS nÃ£o estÃ¡ funcionando corretamente.

ğŸ“‹ PLANO DE AÃ‡ÃƒO

Este guia contÃ©m instruÃ§Ãµes detalhadas para diagnosticar e corrigir problemas
com o deploy automÃ¡tico no VPS. Siga os passos abaixo na ordem indicada.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“Š PASSO 1: DIAGNÃ“STICO

1. FaÃ§a upload do arquivo 'webhook-diagnostico.sh' para o VPS:
   
   scp webhook-diagnostico.sh root@31.97.252.100:/root/

2. Conecte-se ao VPS via SSH:
   
   ssh root@31.97.252.100

3. Execute o script de diagnÃ³stico:
   
   cd /root
   chmod +x webhook-diagnostico.sh
   ./webhook-diagnostico.sh

4. Analise os resultados do diagnÃ³stico para identificar os problemas.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ”§ PASSO 2: CORREÃ‡ÃƒO

1. FaÃ§a upload do arquivo 'webhook-correcao.sh' para o VPS:
   
   scp webhook-correcao.sh root@31.97.252.100:/root/

2. Conecte-se ao VPS via SSH:
   
   ssh root@31.97.252.100

3. Execute o script de correÃ§Ã£o:
   
   cd /root
   chmod +x webhook-correcao.sh
   ./webhook-correcao.sh

4. Aguarde a conclusÃ£o do script. Ele irÃ¡:
   - Reinstalar o serviÃ§o webhook
   - Configurar o Nginx como proxy reverso
   - Configurar verificaÃ§Ã£o periÃ³dica
   - Reiniciar todos os serviÃ§os necessÃ¡rios

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ§ª PASSO 3: TESTE

1. Teste o webhook localmente no VPS:
   
   /var/www/mn/test-webhook.sh

2. Verifique se o serviÃ§o estÃ¡ respondendo:
   
   curl http://localhost:9001/health

3. Verifique os logs do serviÃ§o:
   
   journalctl -u webhook -f

4. FaÃ§a um commit de teste no GitHub:
   
   git commit -m "teste webhook" --allow-empty
   git push origin main

5. Aguarde 2-3 minutos e verifique se o deploy foi executado.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“‹ PASSO 4: VERIFICAÃ‡ÃƒO

1. Verifique se o serviÃ§o webhook estÃ¡ ativo:
   
   systemctl status webhook

2. Verifique se o site foi atualizado:
   
   curl -I http://31.97.252.100

3. Verifique os logs do deploy:
   
   journalctl -u webhook -n 100

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ” PROBLEMAS COMUNS E SOLUÃ‡Ã•ES

1. Webhook nÃ£o inicia:
   - Verifique permissÃµes: chmod +x /var/www/mn/webhook-server.js
   - Verifique logs: journalctl -u webhook -n 50
   - Reinicie manualmente: systemctl restart webhook

2. Webhook inicia mas nÃ£o recebe eventos:
   - Verifique firewall: ufw status
   - Verifique configuraÃ§Ã£o do GitHub: https://github.com/krtur/mn/settings/hooks
   - Verifique Nginx: nginx -t && systemctl status nginx

3. Webhook recebe eventos mas deploy falha:
   - Verifique permissÃµes do diretÃ³rio: ls -la /var/www/mn
   - Verifique logs do deploy: journalctl -u webhook -f
   - Teste deploy manual: /var/www/mn/test-webhook.sh

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“Š VERIFICAÃ‡ÃƒO PERIÃ“DICA

O script de correÃ§Ã£o configurou uma verificaÃ§Ã£o automÃ¡tica a cada 5 minutos
que irÃ¡:

1. Verificar se o serviÃ§o webhook estÃ¡ rodando
2. Verificar se o webhook estÃ¡ respondendo
3. Reiniciar automaticamente se necessÃ¡rio

Logs desta verificaÃ§Ã£o sÃ£o salvos em: /var/log/webhook-check.log

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ‰ CONCLUSÃƒO

ApÃ³s seguir todos os passos acima, o deploy automÃ¡tico deve estar funcionando
corretamente. O sistema agora:

1. Detecta automaticamente novos commits no GitHub
2. Executa o deploy (git pull, npm install, npm run build)
3. Reinicia o servidor (PM2 + Nginx)
4. Verifica periodicamente o funcionamento do webhook

Se ainda houver problemas, execute novamente o script de diagnÃ³stico para
identificar quaisquer questÃµes remanescentes.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
