============================================
üöÄ GUIA COMPLETO - DEPLOY VPS HOSTINGER
============================================

üìã INFORMA√á√ïES DO VPS:
- IP: 31.97.252.100
- OS: Ubuntu 24.04
- SSH: root@31.97.252.100
- Senha: Taliteus@1202
- GitHub: https://github.com/krtur/mn
- Branch: main

============================================
PASSO 1: CONECTAR AO VPS E EXECUTAR SETUP
============================================

1. Abra o PowerShell/Terminal

2. Conecte ao VPS:
   ssh root@31.97.252.100
   (senha: Taliteus@1202)

3. Fa√ßa upload do script de setup:
   
   # No seu computador local (outro terminal):
   scp vps-setup.sh root@31.97.252.100:/root/
   
   # Ou copie e cole o conte√∫do manualmente:
   nano /root/vps-setup.sh
   # Cole o conte√∫do do arquivo vps-setup.sh
   # Ctrl+X, Y, Enter para salvar

4. D√™ permiss√£o de execu√ß√£o:
   chmod +x /root/vps-setup.sh

5. Execute o script:
   /root/vps-setup.sh

   ‚è±Ô∏è Isso vai levar ~5-10 minutos
   ‚òï Pegue um caf√© enquanto instala tudo!

============================================
PASSO 2: CONFIGURAR VARI√ÅVEIS DE AMBIENTE
============================================

1. Edite o arquivo .env:
   nano /var/www/mn/.env

2. Cole suas credenciais do Supabase:
   VITE_SUPABASE_URL=https://sua-url.supabase.co
   VITE_SUPABASE_ANON_KEY=sua_key_aqui

3. Salve: Ctrl+X, Y, Enter

============================================
PASSO 3: CONFIGURAR WEBHOOK DO GITHUB
============================================

1. Gere um secret seguro:
   openssl rand -hex 32
   
   # Copie o resultado (exemplo: a1b2c3d4e5f6...)

2. Edite a configura√ß√£o do webhook:
   nano /var/www/webhook/hooks.json
   
   # Substitua "seu_secret_aqui_mude_isso" pelo secret gerado
   # Salve: Ctrl+X, Y, Enter

3. Reinicie o servi√ßo webhook:
   systemctl restart webhook

4. Configure no GitHub:
   - Acesse: https://github.com/krtur/mn/settings/hooks
   - Clique em "Add webhook"
   - Preencha:
     * Payload URL: http://31.97.252.100:9000/hooks/mn-deploy
     * Content type: application/json
     * Secret: [cole o secret gerado no passo 1]
     * SSL verification: Disable (por enquanto, sem HTTPS)
     * Events: "Just the push event"
     * Active: ‚úì (marcado)
   - Clique em "Add webhook"

============================================
PASSO 4: PRIMEIRO DEPLOY MANUAL
============================================

1. Execute o script de deploy:
   /var/www/mn/deploy.sh

2. Aguarde o build terminar (~2-3 minutos)

3. Acesse no navegador:
   http://31.97.252.100

   ‚úÖ Seu site deve estar funcionando!

============================================
PASSO 5: TESTAR DEPLOY AUTOM√ÅTICO
============================================

1. No seu computador, fa√ßa uma altera√ß√£o pequena:
   # Exemplo: edite o README.md
   echo "# Teste de deploy autom√°tico" >> README.md

2. Commit e push:
   git add .
   git commit -m "Teste deploy autom√°tico"
   git push origin main

3. No VPS, veja os logs do webhook:
   journalctl -u webhook -f
   
   # Voc√™ deve ver:
   # "Deploy iniciado!"
   # "Deploy conclu√≠do com sucesso!"

4. Aguarde ~2-3 minutos e recarregue o site

   ‚úÖ Mudan√ßas devem aparecer automaticamente!

============================================
üìä COMANDOS √öTEIS
============================================

# Ver logs do webhook (deploy autom√°tico)
journalctl -u webhook -f

# Ver logs do Nginx
tail -f /var/log/nginx/error.log
tail -f /var/log/nginx/access.log

# Fazer deploy manual
/var/www/mn/deploy.sh

# Reiniciar servi√ßos
systemctl restart webhook
systemctl restart nginx

# Ver status dos servi√ßos
systemctl status webhook
systemctl status nginx

# Atualizar c√≥digo manualmente
cd /var/www/mn
git pull origin main
npm install
npm run build
systemctl restart nginx

# Ver processos rodando
ps aux | grep webhook
ps aux | grep nginx

# Testar configura√ß√£o do Nginx
nginx -t

# Ver uso de disco
df -h

# Ver uso de mem√≥ria
free -h

# Ver portas abertas
netstat -tulpn

============================================
üîß TROUBLESHOOTING
============================================

PROBLEMA: Site n√£o carrega (502 Bad Gateway)
SOLU√á√ÉO:
  systemctl restart nginx
  journalctl -u nginx -n 50

PROBLEMA: Webhook n√£o funciona
SOLU√á√ÉO:
  systemctl status webhook
  journalctl -u webhook -n 50
  # Verifique se a porta 9000 est√° aberta:
  ufw status
  netstat -tulpn | grep 9000

PROBLEMA: Deploy n√£o atualiza o site
SOLU√á√ÉO:
  # Execute manualmente para ver erros:
  /var/www/mn/deploy.sh
  # Verifique se o .env est√° correto:
  cat /var/www/mn/.env

PROBLEMA: Erro de permiss√£o
SOLU√á√ÉO:
  chown -R root:root /var/www/mn
  chmod +x /var/www/mn/deploy.sh

PROBLEMA: Build falha
SOLU√á√ÉO:
  cd /var/www/mn
  rm -rf node_modules package-lock.json
  npm install
  npm run build

============================================
üîí SEGURAN√áA (RECOMENDA√á√ïES)
============================================

1. Criar usu√°rio n√£o-root:
   adduser deploy
   usermod -aG sudo deploy
   # Use este usu√°rio em vez de root

2. Desabilitar login root via SSH:
   nano /etc/ssh/sshd_config
   # Mude: PermitRootLogin no
   systemctl restart sshd

3. Configurar chaves SSH:
   ssh-keygen -t rsa -b 4096
   ssh-copy-id deploy@31.97.252.100

4. Instalar Fail2Ban:
   apt install fail2ban
   systemctl enable fail2ban

5. Configurar backups autom√°ticos:
   # Adicione ao crontab
   0 2 * * * tar -czf /root/backup-$(date +\%Y\%m\%d).tar.gz /var/www/mn

============================================
üìà PR√ìXIMAS MELHORIAS
============================================

‚úÖ FEITO:
- Deploy autom√°tico via GitHub webhook
- Nginx configurado
- Firewall ativo
- Script de deploy

üîú FUTURO (OPCIONAL):
- [ ] Configurar dom√≠nio pr√≥prio
- [ ] Adicionar SSL/HTTPS com Let's Encrypt
- [ ] Configurar CDN (Cloudflare)
- [ ] Adicionar monitoramento (Uptime Robot)
- [ ] Configurar backups autom√°ticos
- [ ] Adicionar CI/CD com GitHub Actions
- [ ] Configurar logs centralizados
- [ ] Adicionar cache Redis

============================================
üìû SUPORTE
============================================

Se algo der errado:

1. Verifique os logs:
   journalctl -u webhook -f
   tail -f /var/log/nginx/error.log

2. Teste manualmente:
   /var/www/mn/deploy.sh

3. Reinicie os servi√ßos:
   systemctl restart webhook nginx

4. Verifique o status:
   systemctl status webhook nginx

============================================
‚úÖ CHECKLIST FINAL
============================================

[ ] VPS configurado com script vps-setup.sh
[ ] Arquivo .env configurado com credenciais Supabase
[ ] Webhook configurado no GitHub
[ ] Secret do webhook atualizado
[ ] Primeiro deploy manual executado
[ ] Site acess√≠vel em http://31.97.252.100
[ ] Deploy autom√°tico testado com commit
[ ] Logs do webhook funcionando

============================================
üéâ PRONTO!
============================================

Seu site est√° no ar e atualiza automaticamente
a cada push no GitHub!

üåê Acesse: http://31.97.252.100

Qualquer commit na branch main vai:
1. Acionar o webhook
2. Executar git pull
3. Instalar depend√™ncias
4. Fazer build
5. Reiniciar Nginx
6. Site atualizado em ~2-3 minutos!
