================================================================================
TROUBLESHOOTING - TRIAGEM TDAH N√ÉO APARECE PARA TERAPEUTA
================================================================================

üî¥ PROBLEMA: Terapeuta n√£o v√™ triagens do paciente

================================================================================
PASSO 1: VERIFICAR SE OS DADOS FORAM SALVOS
================================================================================

1. Abra Supabase Dashboard > SQL Editor
2. Execute o arquivo: TDAH_VERIFICAR_DADOS.sql
3. Verifique:
   ‚úì H√° triagens na tabela tdah_screenings?
   ‚úì Os patient_id est√£o corretos?
   ‚úì Os pacientes t√™m therapist_id associado?

Se N√ÉO h√° triagens:
   ‚Üí O bot√£o "Salvar Resultados" n√£o funcionou
   ‚Üí Verifique o console do navegador (F12)
   ‚Üí Procure por erros em vermelho

Se H√Å triagens:
   ‚Üí V√° para PASSO 2

================================================================================
PASSO 2: VERIFICAR ASSOCIA√á√ÉO PACIENTE-TERAPEUTA
================================================================================

1. No Supabase, execute:
   SELECT * FROM users WHERE role = 'patient' LIMIT 5;

2. Verifique a coluna "therapist_id":
   ‚úì Est√° preenchida?
   ‚úì O ID corresponde a um terapeuta v√°lido?

Se therapist_id √© NULL:
   ‚Üí O paciente n√£o foi associado a um terapeuta
   ‚Üí Solu√ß√£o: Cadastre o paciente novamente selecionando um terapeuta

Se therapist_id est√° preenchido:
   ‚Üí V√° para PASSO 3

================================================================================
PASSO 3: VERIFICAR POL√çTICAS RLS
================================================================================

1. No Supabase, execute:
   SELECT * FROM pg_policies WHERE tablename = 'tdah_screenings';

2. Voc√™ deve ver 4 pol√≠ticas:
   ‚úì "Patients can view own screenings"
   ‚úì "Patients can insert own screenings"
   ‚úì "Patients can update own screenings"
   ‚úì "Therapists can view patient screenings"

Se FALTAM pol√≠ticas:
   ‚Üí Execute: TDAH_SCREENING_FIX_RLS.sql

Se TODAS est√£o presentes:
   ‚Üí V√° para PASSO 4

================================================================================
PASSO 4: TESTAR ACESSO DO TERAPEUTA
================================================================================

1. Copie o ID do terapeuta (ex: 028d8869-679f-4093-b435-1a43b6ced0e2)

2. No Supabase, execute:
   SELECT * FROM tdah_screenings 
   WHERE patient_id IN (
     SELECT id FROM users WHERE therapist_id = 'COLE_O_ID_DO_TERAPEUTA_AQUI'
   );

3. Resultado:
   ‚úì Se retorna triagens ‚Üí Pol√≠tica est√° funcionando
   ‚úó Se retorna vazio ‚Üí Problema na pol√≠tica

Se retorna vazio:
   ‚Üí Execute: TDAH_SCREENING_FIX_RLS.sql
   ‚Üí Teste novamente

================================================================================
PASSO 5: VERIFICAR CONSOLE DO NAVEGADOR
================================================================================

1. Abra o navegador e fa√ßa login como terapeuta
2. Pressione F12 para abrir o console
3. V√° para Dashboard > Triagens TDAH
4. Procure por mensagens:
   ‚úì "üîç Buscando triagens para paciente: ..."
   ‚úì "üìä Triagens encontradas: X"

Se V√ä as mensagens:
   ‚Üí O c√≥digo est√° funcionando
   ‚Üí Problema pode ser na pol√≠tica RLS

Se N√ÉO v√™ as mensagens:
   ‚Üí O componente n√£o est√° carregando
   ‚Üí Verifique se h√° erros em vermelho no console

================================================================================
PASSO 6: LIMPAR CACHE E RECARREGAR
================================================================================

1. Pressione Ctrl+Shift+Delete (limpar cache)
2. Feche o navegador completamente
3. Reabra e fa√ßa login novamente
4. Teste novamente

================================================================================
SOLU√á√ÉO R√ÅPIDA: DESABILITAR RLS TEMPORARIAMENTE
================================================================================

Se nada funcionar, voc√™ pode desabilitar RLS temporariamente para debug:

1. No Supabase, execute:
   ALTER TABLE tdah_screenings DISABLE ROW LEVEL SECURITY;

2. Teste se o terapeuta consegue ver as triagens

3. Se funcionar:
   ‚Üí O problema √© na pol√≠tica RLS
   ‚Üí Execute: TDAH_SCREENING_FIX_RLS.sql
   ‚Üí Depois reabilite RLS:
      ALTER TABLE tdah_screenings ENABLE ROW LEVEL SECURITY;

4. Se N√ÉO funciona:
   ‚Üí O problema √© no c√≥digo
   ‚Üí Verifique o console do navegador

================================================================================
CHECKLIST FINAL
================================================================================

Antes de reportar um problema, verifique:

‚ñ° SQL foi executado no Supabase?
‚ñ° H√° triagens na tabela tdah_screenings?
‚ñ° Paciente tem therapist_id preenchido?
‚ñ° Pol√≠ticas RLS existem?
‚ñ° Console do navegador n√£o tem erros?
‚ñ° Cache foi limpo?
‚ñ° Navegador foi reiniciado?

Se TODOS os itens est√£o OK e ainda n√£o funciona:
‚Üí Desabilite RLS temporariamente para debug
‚Üí Verifique os logs do Supabase
‚Üí Procure por mensagens de erro espec√≠ficas

================================================================================
LOGS IMPORTANTES
================================================================================

No console do navegador, procure por:

‚úì "‚úì Triagens encontradas para paciente X: 1"
  ‚Üí Significa que a triagem foi encontrada

‚úó "Erro ao buscar triagens: ..."
  ‚Üí Significa que h√° um erro na query

‚úó "Erro ao salvar triagem: ..."
  ‚Üí Significa que o salvamento falhou

Copie a mensagem de erro completa para investiga√ß√£o.

================================================================================
