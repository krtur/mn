â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘         ğŸ§ª TESTE RÃPIDO - WEBHOOK                             â•‘
â•‘         5 minutos para verificar se tudo funciona             â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

============================================
âœ… PASSO 1: VERIFICAR WEBHOOK NO VPS (1 min)
============================================

1. Conecte ao VPS:
   ssh root@31.97.252.100

2. Verifique se o serviÃ§o estÃ¡ rodando:
   systemctl status webhook

   VocÃª deve ver:
   â— webhook.service - M&N Terapeutas - Webhook Server
        Loaded: loaded
        Active: active (running)

3. Se nÃ£o estiver rodando, inicie:
   systemctl start webhook
   systemctl status webhook

4. Teste o health check:
   curl http://localhost:9000/health

   Resposta esperada:
   {"status":"ok","timestamp":"2025-01-01T12:00:00.000Z"}

âœ… PASSO 1 CONCLUÃDO!

============================================
âœ… PASSO 2: CONFIGURAR WEBHOOK NO GITHUB (2 min)
============================================

1. Acesse: https://github.com/krtur/mn/settings/hooks

2. Se jÃ¡ existe um webhook:
   - Clique nele
   - Verifique se a URL estÃ¡ correta:
     http://31.97.252.100:9000/hooks/mn-deploy
   - Verifique se o secret estÃ¡ correto:
     c07e7eaa5d8bab70edf4b3acb837f9426ce96fbbd12ee2b270821cecb11b19b8
   - Se tudo estÃ¡ certo, vÃ¡ para o PASSO 3

3. Se nÃ£o existe webhook:
   - Clique em "Add webhook"
   - Preencha:
     Payload URL: http://31.97.252.100:9000/hooks/mn-deploy
     Content type: application/json
     Secret: c07e7eaa5d8bab70edf4b3acb837f9426ce96fbbd12ee2b270821cecb11b19b8
     Events: Just the push event
     Active: â˜‘ Checked
   - Clique em "Add webhook"

âœ… PASSO 2 CONCLUÃDO!

============================================
âœ… PASSO 3: TESTAR DEPLOY MANUAL (1 min)
============================================

1. No seu computador, faÃ§a um commit vazio:
   git commit -m "teste webhook" --allow-empty

2. FaÃ§a push:
   git push origin main

3. No VPS, veja os logs em tempo real:
   ssh root@31.97.252.100
   journalctl -u webhook -f

4. VocÃª deve ver algo como:
   [timestamp] ğŸ“¨ Webhook recebido do GitHub
   [timestamp] âœ… Assinatura do webhook verificada
   [timestamp] âœ… Push na branch main detectado
   [timestamp] ğŸš€ INICIANDO DEPLOY AUTOMÃTICO
   [timestamp] ğŸ“¥ Fazendo git pull origin main...
   [timestamp] ğŸ“¦ Instalando dependÃªncias...
   [timestamp] ğŸ”¨ Fazendo build...
   [timestamp] ğŸ”„ Reiniciando servidor...
   [timestamp] âœ… DEPLOY CONCLUÃDO COM SUCESSO!

5. Aguarde 2-3 minutos para o deploy completar

âœ… PASSO 3 CONCLUÃDO!

============================================
âœ… PASSO 4: VERIFICAR SITE (1 min)
============================================

1. Recarregue o site:
   http://31.97.252.100

2. Verifique se as mudanÃ§as aparecem

3. Se nÃ£o aparecer:
   - Limpe o cache do navegador (Ctrl+Shift+Del)
   - Recarregue a pÃ¡gina (Ctrl+F5)
   - Aguarde mais um pouco

âœ… PASSO 4 CONCLUÃDO!

============================================
ğŸ‰ TUDO FUNCIONANDO!
============================================

Se chegou aqui, o webhook estÃ¡ funcionando perfeitamente!

De agora em diante:
1. VocÃª faz commit e push no GitHub
2. GitHub notifica o webhook
3. Webhook executa o deploy automaticamente
4. Site Ã© atualizado em 2-3 minutos

============================================
âŒ ALGO DEU ERRADO?
============================================

ERRO: "Assinatura invÃ¡lida"
SOLUÃ‡ÃƒO: Verifique se o secret estÃ¡ correto no GitHub

ERRO: "Deploy nÃ£o executa"
SOLUÃ‡ÃƒO: 
   1. Verifique os logs: journalctl -u webhook -f
   2. Teste manualmente: curl -X POST http://31.97.252.100:9000/hooks/test
   3. Verifique se o webhook estÃ¡ configurado no GitHub

ERRO: "Site nÃ£o atualiza"
SOLUÃ‡ÃƒO:
   1. Aguarde 2-3 minutos
   2. Limpe o cache do navegador
   3. Verifique se o build foi bem-sucedido nos logs

ERRO: "Webhook nÃ£o responde"
SOLUÃ‡ÃƒO:
   1. Verifique se estÃ¡ rodando: systemctl status webhook
   2. Reinicie: systemctl restart webhook
   3. Verifique os logs: journalctl -u webhook -n 20

Para mais detalhes, consulte: WEBHOOK_GUIA_COMPLETO.txt
